<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GEMIROSE MUSIC WORLD</title>
  <style>
    :root {
      /* 定义主题颜色 */
      --primary-color: #fbc0d9; /* 主色调：粉色 */
      --secondary-color: #fbc0d9; /* 辅色调：粉色 */
      /* 深色背景 */
      --background-dark: #2a2a2a; /* 整体深色背景 */
      --background-darker: #1c1c1c; /* 元素更深的背景 */
      /* 文本颜色 */
      --text-color: #e0e0e0; /* 主要文本颜色 */
      --text-secondary: #aaaaaa; /* 次要文本颜色 */
      /* 渐变色 */
      --gradient: linear-gradient(145deg, var(--primary-color), var(--secondary-color));
      /* 阴影效果 */
      --shadow: 0 8px 25px rgba(0, 0, 0, 0.5); /* 更柔和、更弥散的阴影 */
      /* 圆角 */
      --radius: 18px; /* 更大的圆角，更符合Liquid Glass的柔和感 */
      --card-radius: 18px; /* 卡片圆角 */
      /* 内边距 */
      --padding: 20px; /* 增加内边距 */

      /* 按钮基础背景色 */
      --button-background: #3a3a3a;
      --button-hover-background: #4a4a4a;
      --button-active-background: #2a2a2a;
      --button-text-color: var(--primary-color);

      /* 液态玻璃按钮特定变量 */
      --button-glass-bg: rgba(255, 255, 255, 0.1);
      --button-glass-border-color: rgba(255, 255, 255, 0.5);
      --button-glass-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      --button-glass-inset-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.2);
      --button-glass-radius: 20px; /* 新增：按钮圆角 */
      --button-shine-bg: rgba(255, 255, 255, 0.05);
      --button-shine-shadow-1: inset -5px -4px 0px -5.5px rgba(255, 255, 255, 0.7);
      --button-shine-shadow-2: inset 0px -4.5px 0px -4px rgba(255, 255, 255, 0.7);
      --button-shine-opacity: 0.6;

      --button-hover-bg: rgba(255, 255, 255, 0.2);
      --button-hover-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
      --button-active-bg: rgba(255, 255, 255, 0.05);
      --button-active-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);

      /* Advanced Apple Liquid Glass Effect Variables */
      --liquid-bg-color: 255, 255, 255; /* Base color for glass, for easier rgba() usage */
      --liquid-bg-opacity: 0; /* 稍微增加一点点背景可见度，或者根据喜好减少 */
      --liquid-bg: rgba(var(--liquid-bg-color), var(--liquid-bg-opacity));
      --liquid-blur: 25px; /* 大幅减少模糊半径以提升性能 */
      --liquid-saturate: 110%; /* 稍微降低饱和度，让其更柔和 */
      --liquid-brightness: 110%; /* 稍微降低亮度 */
      --liquid-border-color: rgba(var(--liquid-bg-color), 0.15);
      --liquid-border: 1px solid var(--liquid-border-color);
      --liquid-shadow-color: 0, 0, 0;
      --liquid-shadow-strong: 0 15px 45px rgba(var(--liquid-shadow-color), 0.25);
      --liquid-shadow-soft: 0 2px 10px rgba(var(--liquid-shadow-color), 0.15);
      --liquid-shadow: var(--liquid-shadow-strong), var(--liquid-shadow-soft);
      --liquid-inner-shadow: inset 0 1px 2px rgba(var(--liquid-bg-color), 0.1), inset 0 -1px 1px rgba(var(--liquid-shadow-color), 0.05);

      --liquid-shine-opacity: 0.6; /* 降低高光透明度，使其更微妙 */
      --liquid-shine-blur: 4px; /* 减少高光模糊，使其更清晰，同时提升性能 */
      /* 尝试简化高光效果，如果依然卡顿，可以暂时注释掉一个 */
      --liquid-shine-highlight-1: radial-gradient(ellipse 60% 30% at 20% 20%, rgba(var(--liquid-bg-color), 0.3) 0%, rgba(var(--liquid-bg-color), 0) 100%); /* 调整高光强度和位置 */
      --liquid-shine-highlight-2: radial-gradient(ellipse 50% 25% at 80% 80%, rgba(var(--liquid-bg-color), 0.15) 0%, rgba(var(--liquid-bg-color), 0) 100%); /* 调整高光强度和位置 */
      --liquid-shine-edge: linear-gradient(to bottom, rgba(var(--liquid-bg-color), 0.15) 0%, rgba(var(--liquid-bg-color), 0) 15%), linear-gradient(to top, rgba(var(--liquid-bg-color), 0.15) 0%, rgba(var(--liquid-bg-color), 0) 15%); /* Softer edge highlights */

      --liquid-item-bg-opacity: 0.025;
      --liquid-item-bg: rgba(var(--liquid-bg-color), var(--liquid-item-bg-opacity));
      --liquid-item-border-color: rgba(var(--liquid-bg-color), 0.08);
      --liquid-item-border: 1px solid var(--liquid-item-border-color);
      --liquid-item-shadow: 0 2px 8px rgba(var(--liquid-shadow-color), 0.1); /* 更轻微的阴影 */
      --liquid-item-blur: 5px; /* 大幅降低内部元素的模糊值 */
      --liquid-item-saturate: 100%; /* 恢复到默认值 */
      --liquid-item-brightness: 100%; /* 恢复到默认值 */
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* 更改字体，更现代 */
      background-color: #1a1a1d; /* 更深邃的背景 */
      /* 添加背景图片以增强透明效果 */
      background-image: url('https://source.unsplash.com/random/1920x1080?dark,abstract,gradient'); 
      background-size: cover;
      background-position: center;
      background-attachment: fixed; /* 固定背景，滚动时内容移动 */
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: var(--text-color);
      line-height: 1.6; /* 增加行高 */
      overflow-x: hidden; /* 防止水平滚动条 */
    }

    .container {
      position: relative; /* For pseudo-element positioning */
      /* background: var(--liquid-bg); -- Background will be handled by a pseudo-element for better blur */
      border: var(--liquid-border);
      border-radius: var(--radius); /* 使用更新后的 --radius */
      box-shadow: var(--liquid-shadow), var(--liquid-inner-shadow);
      padding: var(--padding);
      width: 100%;
      max-width: 960px;
      text-align: center;
      box-sizing: border-box;
      margin: 20px auto;
      z-index: 1;
      overflow: hidden; /* Crucial for clipping oversized pseudo-elements */
      /* transition: transform 0.3s ease-out, box-shadow 0.3s ease-out; /* For potential subtle hover effects */
    }

    /* Optional: Subtle perspective on hover for the container */
    /*
    body:hover .container {
      transform: perspective(1000px) rotateX(1deg) rotateY(-1deg) scale(1.01);
      box-shadow: 0 25px 60px rgba(0,0,0,0.3), var(--liquid-inner-shadow);
    }
    */

    .container::before { /* Blurred background layer */
      content: '';
      position: absolute;
      /* Make it slightly larger than the container to allow edge pixels to be part of the blur */
      top: -10px; left: -10px; right: -10px; bottom: -10px;
      background: var(--liquid-bg);
      backdrop-filter: blur(var(--liquid-blur)) saturate(var(--liquid-saturate)) brightness(var(--liquid-brightness));
      border-radius: calc(var(--radius) + 10px); /* Adjust radius to match oversized nature */
      z-index: -1; /* Behind the content, but above body background */
      pointer-events: none;
    }

    .container::after { /* Main shine layer, changed from ::before to ::after to stack on top of the new ::before */
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      border-radius: var(--radius);
      background: var(--liquid-shine-highlight-1), var(--liquid-shine-highlight-2), var(--liquid-shine-edge);
      opacity: var(--liquid-shine-opacity);
      z-index: 0; /* Above blurred background, below content */
      pointer-events: none;
      mix-blend-mode: overlay; /* Blend highlights softly */
      filter: blur(var(--liquid-shine-blur)); /* Slightly reduced blur for sharper highlights */
    }
    /* Removed the second pseudo-element for shine, consolidated into ::before or rely on main bg + single shine */

    h1 {
      font-size: 32px; /* 标题更大 */
      margin-bottom: 30px; /* 增加底部间距 */
      color: var(--primary-color);
      text-shadow: 0 3px 6px rgba(0,0,0,0.6); /* 标题阴影更深 */
      letter-spacing: 1.5px; /* 增加字间距 */
    }

    .album-carousel, .album-details {
      position: relative;
      /* width: 95.5%; */ /* 暂时注释掉或调整，让padding来控制内部空间 */
      width: 100%; /* 或者保持100%，让父级.container的padding生效 */
      box-sizing: border-box; /* 确保padding和border包含在width内 */
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 25px; /* 增加间距 */
      border-radius: var(--card-radius);
      background: var(--liquid-item-bg);
      border: var(--liquid-item-border);
      box-shadow: var(--liquid-item-shadow);
      backdrop-filter: blur(var(--liquid-item-blur)); 
      transition: background 0.3s ease, box-shadow 0.3s ease; /* Smooth transitions */
    }

    .album-carousel {
      height: 400px; /* 增加轮播高度 */
      overflow: hidden;
      padding-top: 15px;
      padding-left: 20px; /* 新增左边距 */
      padding-right: 20px; /* 新增右边距，使其与左边对称 */
      /* 如果 .album-carousel 的 width 设置为 100% 或 auto，确保其父容器 .container 有合适的左右 padding */
    }

    .album-details {
      min-height: 400px; /* 增加详情页最小高度 */
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--liquid-item-bg); 
      border: var(--liquid-item-border); 
      border-radius: var(--card-radius);
      padding: var(--padding);
      animation: fadeIn 0.6s ease-out; /* 动画稍慢 */
      box-shadow: var(--liquid-item-shadow); 
      /* 简化 backdrop-filter */
      backdrop-filter: blur(var(--liquid-item-blur)); 
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(20px); } /* 初始位置更低 */
      100% { opacity: 1; transform: translateY(0); }
    }

    .album-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: var(--padding);
    }

    .album-header img {
      width: auto;
      height: 220px; /* 专辑封面稍大 */
      border-radius: var(--card-radius); /* 统一使用卡片圆角 */
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5); /* 专辑封面阴影更深 */
      transition: transform 0.4s ease, opacity 0.4s ease;
    }

    .album-header img:hover {
      opacity: 0.95;
      transform: scale(1.03); /* 悬停时放大更多 */
    }

    .song-name {
      font-size: 24px;
      font-weight: 700;
      margin-top: 20px; /* 增加间距 */
      color: var(--secondary-color);
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }

    .carousel-inner {
      display: flex;
      /* justify-content: center; */ /* 当使用绝对定位和transform时，这个可能不是主要居中方式 */
      transition: transform 0.8s ease-in-out;
      position: absolute; /* 保持绝对定位以便JS控制滑动 */
      left: 0; /* 改动：从50%改为0，使其从父元素的左边开始 */
      transform: translateX(0); /* 改动：调整transform，使其不进行水平偏移，或者设置为 none */
      padding: 10px 0; /* 增加垂直内边距 */
      /* 确保 .carousel-inner 的宽度能够容纳所有 .carousel-item */
      /* 如果需要，JS动态计算其宽度会更灵活 */
      /* 或者，如果希望内容在可视区域内滚动，这里的宽度可能需要是所有item的总和 */
    }

    .carousel-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 25px; /* 增加左右间距 */
      text-align: center;
      cursor: pointer;
      padding: 15px; /* 增加内边距 */
      border-radius: var(--card-radius);
      background-color: var(--liquid-item-bg);
      border: var(--liquid-item-border);
      box-shadow: var(--liquid-item-shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
      min-width: 200px; /* 设定最小宽度 */
      backdrop-filter: blur(calc(var(--liquid-item-blur) * 0.8)) saturate(calc(var(--liquid-item-saturate) * 0.9)) brightness(var(--liquid-item-brightness));
    }

    .carousel-item:hover {
      transform: scale(1.08); /* 悬停时放大更多 */
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5); /* 悬停时阴影更明显 */
      background-color: rgba(255,255,255,0.15); /* Brighter on hover */
    }

    .album-carousel img {
      width: auto;
      height: 220px; /* 轮播专辑封面稍大 */
      border-radius: var(--card-radius); /* 统一使用卡片圆角 */
      object-fit: contain;
      loading: lazy;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }

    .carousel-item .song-name {
      margin-top: 12px;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-color);
    }

    .track-list {
      width: 95.5%;
      padding: var(--padding);
      background: var(--liquid-item-bg);
      border: var(--liquid-item-border);
      border-radius: var(--card-radius);
      overflow-y: auto;
      max-height: 280px; /* 增加最大高度 */
      box-shadow: var(--liquid-item-shadow);
      backdrop-filter: blur(var(--liquid-item-blur)) saturate(var(--liquid-item-saturate)) brightness(var(--liquid-item-brightness));
    }

    .track-item {
      display: flex;
      align-items: center;
      padding: 12px 15px; /* 增加内边距 */
      margin: 10px 0; /* 增加上下间距 */
      background: rgba(var(--liquid-bg-color), calc(var(--liquid-item-bg-opacity) * 1.2)); /* Slightly more opaque than parent items */
      border-radius: calc(var(--card-radius) - 8px); /* Smaller radius for inset feel */
      border: 1px solid rgba(var(--liquid-bg-color), 0.06);
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 1px 4px rgba(var(--liquid-shadow-color), 0.08);
      min-height: 48px; /* 确保触摸目标大小 */
      backdrop-filter: blur(calc(var(--liquid-item-blur) * 0.7)) saturate(calc(var(--liquid-item-saturate) * 0.8)) brightness(calc(var(--liquid-item-brightness) * 0.95));
    }

    .track-item:hover {
      background: rgba(255, 255, 255, 0.25); /* Brighter on hover */
      transform: translateY(-3px); /* 悬停时轻微上浮更多 */
      box-shadow: 0 5px 10px rgba(0,0,0,0.3);
    }

    .track-item.playing {
      background: var(--gradient);
      color: #1a1a1a; /* 播放中文字颜色更深 */
      font-weight: bold;
      box-shadow: 0 3px 8px rgba(0,0,0,0.4);
      animation: pulseHighlight 1s infinite alternate; /* 播放中增加脉冲动画 */
    }

    @keyframes pulseHighlight {
      0% { transform: scale(1); box-shadow: 0 3px 8px rgba(0,0,0,0.4); }
      100% { transform: scale(1.01); box-shadow: 0 5px 12px rgba(0,0,0,0.5); }
    }

    .track-item .track-number {
      width: 35px; /* 调整宽度 */
      font-size: 16px;
      color: var(--text-secondary);
      flex-shrink: 0; /* 防止挤压 */
    }

    .track-item.playing .track-number {
      color: #1a1a1a;
    }

    .track-item .track-name {
      flex-grow: 1;
      font-size: 16px;
      font-weight: 600;
      white-space: nowrap; /* 防止歌名换行 */
      overflow: hidden; /* 隐藏溢出部分 */
      text-overflow: ellipsis; /* 显示省略号 */
    }

    .track-item .track-duration {
      font-size: 14px;
      color: var(--text-secondary);
      flex-shrink: 0; /* 防止挤压 */
      margin-left: 10px; /* 增加左侧间距 */
    }

    .track-item.playing .track-duration {
      color: rgba(26,26,26,0.8);
    }

    .audio-container {
      /* width: 95.5%; */ /* 改动：注释或移除此行 */
      width: 100%; /* 新增：确保撑满父容器的可用宽度 */
      box-sizing: border-box; /* 新增：确保 padding 和 border 在 width 内 */
      padding: 20px; /* 保留或根据需要调整 */
      /* 播放器背景渐变透明度调整 - 原有背景将被液态玻璃效果取代或叠加 */
      /* background: linear-gradient(145deg, #2a2a2a, rgba(251, 192, 217, 0.4)); */
      
      /* 应用液态玻璃效果 */
      background: var(--liquid-item-bg); /* 使用项目背景色 */
      border: var(--liquid-item-border); /* 使用项目边框 */
      border-radius: var(--radius); /* 与容器一致的圆角 */
      box-shadow: var(--liquid-item-shadow); /* 使用项目阴影 */
      backdrop-filter: blur(var(--liquid-item-blur)) saturate(var(--liquid-item-saturate)) brightness(var(--liquid-item-brightness)); /* 应用背景模糊等效果 */
      /* 如果需要更强的玻璃感，可以考虑添加类似 .container::after 的高光伪元素，但这会增加复杂性 */

      margin-top: var(--padding);
      /* box-shadow: var(--shadow); -- 已被 --liquid-item-shadow 取代 */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px; /* 控制元素之间的间距 */
      position: relative; /* 添加 position: relative 以便未来可能添加的伪元素定位 */
      z-index: 0; /* 确保在 .container 的伪元素之下，但高于普通背景 */
    }

    /* 隐藏原生 audio 元素 */
    audio {
      display: none;
    }

    .current-track {
      font-size: 18px; /* 字体更大 */
      font-weight: 700;
      color: var(--text-color);
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      white-space: nowrap; /* 防止歌曲名换行 */
      overflow: hidden; /* 隐藏溢出部分 */
      text-overflow: ellipsis; /* 显示省略号 */
      width: 100%; /* 确保占据可用宽度 */
      text-align: center; /* 居中显示 */
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 20px; /* 按钮和进度条之间的间距 */
      width: 100%;
      /* justify-content: center; */ /* 如果希望两端对齐，可以考虑 space-between */
      /* padding: 0 20px; */ /* 或者在这里添加左右padding来控制内部元素的边距 */
      box-sizing: border-box; /* 确保padding在width内 */
      justify-content: center; /* 保持居中，如果audio-container已对称，则整体也会对称 */
      flex-wrap: wrap; /* 小屏幕下允许换行 */
    }

    /* 播放/暂停按钮优化 (Neumorphism / Soft UI) */
    .play-pause-btn {
      background-color: var(--button-background);
      border: none;
      color: var(--button-text-color); /* 图标颜色由SVG的fill控制 */
      padding: 0;
      font-size: 28px; /* 播放按钮图标更大，但实际由SVG大小决定 */
      cursor: pointer;
      border-radius: 50%;
      width: 60px; /* 略微增大，更显大气 */
      height: 60px;
      display: flex; /* 让按钮成为flex容器，用于居中SVG */
      justify-content: center;
      align-items: center;
      transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
      flex-shrink: 0;

      /* 拟物化扁平质感的关键：内外阴影组合 */
      box-shadow:
              -5px -5px 10px rgba(255, 255, 255, 0.05), /* 左上浅色阴影 */
              5px 5px 10px rgba(0, 0, 0, 0.4),          /* 右下深色阴影 */
              inset 2px 2px 5px rgba(255, 255, 255, 0.02), /* 内部高光，增加质感 */
              inset -2px -2px 5px rgba(0, 0, 0, 0.1);    /* 内部阴影 */
    }

    .play-pause-btn:hover {
      background-color: var(--button-hover-background); /* 悬停时背景稍亮 */
      transform: translateY(-2px); /* 轻微上浮，增加动感 */
      color: var(--secondary-color); /* 悬停时图标颜色变化，通过SVG的fill继承 */

      /* 悬停时的阴影变化，模拟“浮起”感更强 */
      box-shadow:
              -8px -8px 15px rgba(255, 255, 255, 0.08),
              8px 8px 15px rgba(0, 0, 0, 0.5),
              inset 1px 1px 3px rgba(255, 255, 255, 0.03),
              inset -1px -1px 3px rgba(0, 0, 0, 0.15);
    }

    .play-pause-btn:active {
      transform: translateY(0); /* 按下时回到原位 */
      background-color: var(--button-active-background); /* 点击时背景更暗 */
      color: var(--primary-color); /* 点击时图标颜色，通过SVG的fill继承 */

      /* 点击时模拟“按入”效果，内外阴影反转 */
      box-shadow:
              inset 5px 5px 10px rgba(0, 0, 0, 0.6),            /* 模拟按入的深色阴影 */
              inset -5px -5px 10px rgba(255, 255, 255, 0.08),  /* 模拟按入的浅色高光 */
              -2px -2px 5px rgba(255, 255, 255, 0.02),         /* 外部浅色阴影减弱 */
              2px 2px 5px rgba(0, 0, 0, 0.2);                   /* 外部深色阴影减弱 */
    }

    /* SVG icon styling - **调整此处** */
    .play-pause-btn svg {
      width: 70%; /* 让SVG占据其父级span的70%宽度 */
      height: 70%; /* 让SVG占据其父级span的70%高度 */
      object-fit: contain; /* 保持宽高比 */
      fill: currentColor; /* 让SVG颜色继承父级的color属性 */
      transition: fill 0.3s ease; /* 颜色变化的平滑过渡 */
    }

    /* 隐藏不活跃的图标 */
      .inactive-icon {
      display: none;
    }

    /* 显示活跃的图标 */
    .active-icon {
      display: flex; /* 使用flex来居中SVG图标 */
      justify-content: center;
      align-items: center;
      width: 100%; /* 确保span占据可用空间 */
      height: 100%;
    }

    /* 悬停和点击时SVG图标的颜色变化将通过按钮的:hover/:active状态和currentColor继承 */

    .progress-container {
      flex-grow: 1; /* 占据剩余空间 */
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 180px; /* 确保进度条有最小宽度 */
    }

    .progress-bar {
      -webkit-appearance: none;
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 5px;
      outline: none;
      transition: background 0.2s ease;
      cursor: pointer;
    }

    .progress-bar::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: grab;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    .progress-bar::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: grab;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    .time-display {
      font-size: 14px;
      white-space: nowrap; /* 防止时间显示换行 */
      min-width: 80px; /* 确保时间显示有足够空间 */
      text-align: right;
    }

    .volume-container {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0; /* 防止被压缩 */
    }

    /* 音量按钮优化 (扁平化有质感) */
    .volume-btn {
      background: none; /* 完全透明背景 */
      border: none;
      color: var(--text-secondary); /* 默认图标颜色更柔和，现在作为文本颜色 */
      font-size: 16px; /* **调整：字体大小以适应文字** */
      cursor: pointer;
      transition: color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease; /* 添加box-shadow过渡 */
      padding: 8px 12px; /* **调整：根据文字内容调整内边距** */
      border-radius: 20px; /* 适应文本的圆角 */
      display: flex; /* 让按钮成为flex容器，用于居中文本 */
      justify-content: center;
      align-items: center;
      /* 初始轻微内阴影 */
      box-shadow: inset 1px 1px 3px rgba(0,0,0,0.1), inset -1px -1px 3px rgba(255,255,255,0.03);
      min-width: 60px; /* 确保有足够的最小宽度 */
    }

    .volume-btn:hover {
      color: var(--primary-color); /* 悬停时变为主题色 */
      transform: scale(1.05); /* 轻微放大，增强反馈 */
      /* 悬停时增加外部轻微阴影，模拟浮起 */
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.05),
      inset 1px 1px 3px rgba(0,0,0,0.1), inset -1px -1px 3px rgba(255,255,255,0.03);
    }

    .volume-btn:active {
      transform: scale(0.95); /* 点击时轻微缩小，模拟按压 */
      color: var(--secondary-color); /* 点击时图标颜色 */
      /* 点击时模拟“按入”效果，内外阴影反转或调整 */
      box-shadow: inset 2px 2px 5px rgba(0,0,0,0.3), inset -2px -2px 5px rgba(255,255,255,0.05);
    }

    /* 删除或注释掉关于 .volume-btn svg 的样式 */
    /* .volume-btn svg {
      width: 70%;
      height: 70%;
      object-fit: contain;
      fill: currentColor;
      transition: fill 0.3s ease;
    } */

    .volume-slider {
      -webkit-appearance: none;
      width: 80px; /* 音量滑块宽度 */
      height: 6px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
      outline: none;
      transition: background 0.2s ease;
      cursor: grab;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: grab;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    .volume-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: grab;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }


    .footer {
      margin-top: var(--padding);
      font-size: 14px;
      color: var(--text-secondary);
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    .carousel-btns, .back-btn {
      display: flex;
      justify-content: space-between;
      margin-top: 20px; /* 增加间距 */
    }

    .carousel-btns button, .back-btn button, .random-btn {
      position: relative; /* For pseudo-element */
      background: var(--button-glass-bg);
      backdrop-filter: blur(8px) saturate(150%);
      border: 1px solid var(--button-glass-border-color);
      color: var(--button-text-color);
      padding: 12px 25px;
      font-size: 16px;
      cursor: pointer;
      border-radius: var(--button-glass-radius); /* Use glass button radius */
      transition: all 0.3s ease;
      font-weight: 700;
      letter-spacing: 0.5px;
      min-width: 100px;
      overflow: hidden; /* Important for pseudo-element */
      box-shadow: var(--button-glass-shadow), var(--button-glass-inset-shadow);
      text-decoration: none; /* If it's a link styled as a button */
      display: inline-flex; /* For proper alignment if content varies */
      align-items: center;
      justify-content: center;
    }

    .carousel-btns button::after, .back-btn button::after, .random-btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--button-shine-bg);
      border-radius: var(--button-glass-radius); /* Match button's border-radius */
      backdrop-filter: blur(1px);
      box-shadow: var(--button-shine-shadow-1), var(--button-shine-shadow-2);
      opacity: var(--button-shine-opacity);
      z-index: 0; /* Behind content */
      transition: opacity 0.3s ease;
    }
    
    .carousel-btns button > *, .back-btn button > *, .random-btn > * {
        position: relative;
        z-index: 1; /* Ensure text/icon is above shine */
    }

    .carousel-btns button:hover, .back-btn button:hover, .random-btn:hover {
      background: var(--button-hover-glass-bg);
      box-shadow: var(--button-hover-glass-shadow), var(--button-hover-glass-inset-shadow);
      color: var(--secondary-color);
      transform: translateY(0); /* Override previous transform if any */
    }

    .carousel-btns button:hover::after, .back-btn button:hover::after, .random-btn:hover::after {
      opacity: var(--button-hover-shine-opacity);
    }

    .carousel-btns button:active, .back-btn button:active, .random-btn:active {
      transform: scale(0.98);
      background: var(--button-glass-bg);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 0 1px 5px rgba(255,255,255,0.1);
    }

    .hidden {
      display: none;
    }

    /* 改进焦点状态 */
    *:focus-visible {
      outline: 3px solid var(--secondary-color); /* 更明显的焦点轮廓 */
      outline-offset: 4px;
      border-radius: var(--radius);
    }

    /* 媒体查询优化 */
    @media (max-width: 768px) {
      :root {
        --padding: 15px;
        --radius: 10px;
      }

      .container {
        width: 95%;
        padding: 15px;
        margin: 15px auto; /* 调整小屏幕上下间距 */
      }

      h1 {
        font-size: 28px;
        margin-bottom: 20px;
      }

      .album-carousel {
        height: 320px;
      }

      .album-details {
        min-height: 320px;
      }

      .album-header img, .album-carousel img {
        height: 180px;
      }

      .album-header .song-name {
        font-size: 20px;
        margin-top: 15px;
      }

      .carousel-item {
        margin: 0 15px;
        padding: 12px;
        min-width: 180px; /* 调整 carousel item 最小宽度 */
      }

      .carousel-item .song-name {
        font-size: 14px;
      }

      .track-list {
        max-height: 220px;
        padding: 10px; /* 调整歌曲列表内边距 */
      }

      .track-item {
        padding: 10px 12px;
        font-size: 14px;
        margin: 8px 0; /* 调整歌曲项上下间距 */
      }

      .track-item .track-number {
        font-size: 14px;
        width: 30px;
      }

      .track-item .track-name, .track-item .track-duration {
        font-size: 13px;
      }

      .current-track {
        font-size: 16px;
      }

      .controls {
        flex-direction: column; /* 垂直布局 */
        gap: 15px;
      }

      .play-pause-btn {
        width: 55px;
        height: 55px;
        font-size: 24px;
        order: 1; /* 播放按钮放在最前面 */
      }

      .progress-container {
        width: 100%; /* 占据整行 */
        order: 2; /* 进度条在播放按钮下面 */
        gap: 5px;
      }

      .time-display {
        font-size: 12px;
        min-width: 60px;
      }

      .volume-container {
        width: 93%;
        justify-content: center; /* 音量控制居中 */
        order: 3; /* 音量控制在最下面 */
        gap: 5px;
      }

      /* 媒体查询中的音量按钮调整 */
      .volume-btn {
        font-size: 14px; /* **调整：在小屏幕下略微调整** */
        padding: 6px 10px; /* **调整：在小屏幕下略微调整** */
        min-width: auto; /* 取消最小宽度限制，让内容撑开 */
      }

      .volume-slider {
        width: 100px;
      }

      .carousel-btns button, .back-btn button, .random-btn {
        padding: 10px 18px;
        font-size: 14px;
        min-width: 80px; /* 调整按钮最小宽度 */
      }
    }

    @media (max-width: 480px) {
      :root {
        --padding: 10px;
        --radius: 8px;
      }

      body {
        min-height: auto; /* 手机上取消 min-height */
        padding-bottom: 20px; /* 为底部内容留出空间 */
      }

      .container {
        width: 93%;
        padding: 10px;
        margin: 10px auto;
      }

      h1 {
        font-size: 24px;
        margin-bottom: 15px;
      }

      .album-carousel {
        height: 280px;
        padding-top: 10px;
      }

      .album-details {
        min-height: 280px;
        padding: 15px;
      }

      .album-header img, .album-carousel img {
        height: 150px;
      }

      .album-header .song-name {
        font-size: 18px;
        margin-top: 10px;
      }

      .carousel-inner {
        padding: 5px 0;
      }

      .carousel-item {
        margin: 0 10px;
        padding: 8px;
        min-width: 150px; /* 调整 carousel item 最小宽度 */
      }

      .carousel-item .song-name {
        font-size: 13px;
      }

      .track-list {
        max-height: 180px;
        padding: 8px;
      }

      .track-item {
        padding: 8px 10px;
        font-size: 13px;
        margin: 6px 0;
      }

      .track-item .track-number {
        font-size: 13px;
        width: 25px;
      }

      .track-item .track-name, .track-item .track-duration {
        font-size: 12px;
      }

      .current-track {
        font-size: 14px;
      }

      .play-pause-btn {
        width: 50px;
        height: 50px;
        font-size: 20px;
      }

      /* 媒体查询中的音量按钮调整 */
      .volume-btn {
        font-size: 12px; /* **调整：在更小屏幕下进一步调整** */
        padding: 5px 8px; /* **调整：在更小屏幕下进一步调整** */
      }

      .volume-slider {
        width: 70px;
      }

      .carousel-btns button, .back-btn button, .random-btn {
        padding: 8px 15px;
        font-size: 13px;
        border-radius: 25px;
        min-width: 70px; /* 调整按钮最小宽度 */
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>GEMIROSE MUSIC WORLD</h1>

  <div class="album-carousel" role="region" aria-label="专辑轮播">
    <div class="carousel-inner">
      <div class="carousel-item" data-album="Pink Venom">
        <img src="pink venom.jpg" alt="Pink Venom 专辑封面" data-src="Pink Venom.mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">Pink Venom</div>
      </div>
      <div class="carousel-item" data-album="BORN PINK">
        <img src="bornpink.jpg" alt="BORN PINK 专辑封面" data-src="Shut Down.mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">BORN PINK</div>
      </div>
      <div class="carousel-item" data-album="THE ALBUM">
        <img src="how you like that.jpg" alt="THE ALBUM 专辑封面" data-src="How You Like That.mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">THE ALBUM</div>
      </div>
      <div class="carousel-item" data-album="The Girls">
        <img src="the girls.jpg" alt="The Girls 专辑封面" data-src="THE GIRLS (BLACKPINK THE GAME OST).mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">The Girls</div>
      </div>
      <div class="carousel-item" data-album="AMORTAGE">
        <img src="秀.jpg" alt="AMORTAGE 专辑封面" data-src="earthquake.mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">AMORTAGE</div>
      </div>
      <div class="carousel-item" data-album="RUBY">
        <img src="妮1.jpg" alt="RUBY 专辑封面" data-src="Mantra (Explicit).mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">RUBY</div>
      </div>
      <div class="carousel-item" data-album="like JENNIE">
        <img src="妮2.jpg" alt="like JENNIE 专辑封面" data-src="like JENNIE (Explicit).mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">Like JENNIE (Explicit)</div>
      </div>
      <div class="carousel-item" data-album="ROSIE">
        <img src="肉1.jpg" alt="ROSIE 专辑封面" data-src="toxic till the end.mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">ROSIE</div>
      </div>
      <div class="carousel-item" data-album="Number One Girl">
        <img src="NOG.jpg" alt="Number One Girl 专辑封面" data-src="number one girl.mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">Number One Girl</div>
      </div>
      <div class="carousel-item" data-album="Rockstar">
        <img src="莎2.jpg" alt="Rockstar 专辑封面" data-src="Rockstar.mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">Rockstar</div>
      </div>
      <div class="carousel-item" data-album="ALTER EGO">
        <img src="莎1.jpg" alt="ALTER EGO 专辑封面" data-src="Thunder.mp3" onerror="this.src='fallback.jpg'" loading="lazy">
        <div class="song-name">ALTER EGO</div>
      </div>
    </div>
  </div>

  <div class="album-details hidden">
    <div class="album-header">
      <img id="albumImage" src="" alt="专辑封面" loading="lazy">
      <div class="song-name" id="albumTitle"></div>
    </div>
    <div class="track-list" id="trackList"></div>
  </div>

  <div class="carousel-btns">
    <button id="prevBtn" aria-label="上一张专辑">◀</button>
    <button id="randomBtn" class="random-btn" aria-label="随机播放">随机</button>
    <button id="nextBtn" aria-label="下一张专辑">▶</button>
  </div>

  <div class="back-btn hidden">
    <button id="backBtn" aria-label="返回轮播">返回</button>
  </div>

  <div class="audio-container">
    <div class="current-track" id="currentTrack">未选择歌曲</div>
    <audio id="audioPlayer" title="音乐播放器">
      <source id="audioSource" src="" type="audio/mpeg">
      您的浏览器不支持音频元素。
    </audio>

    <div class="controls">
      <button id="playPauseBtn" class="play-pause-btn" aria-label="播放/暂停">
        <span class="icon-play active-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </span>
        <span class="icon-pause inactive-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
          </svg>
        </span>
      </button>
      <div class="progress-container">
        <span id="currentTime">0:00</span>
        <input type="range" id="progressBar" class="progress-bar" value="0" step="0.01" aria-label="播放进度">
        <span id="totalTime">0:00</span>
      </div>
      <div class="volume-container">
        <button id="volumeBtn" class="volume-btn" aria-label="音量开关">
          音量
        </button>
        <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.01" value="1" aria-label="音量控制">
      </div>
    </div>
  </div>

  <div class="footer">
    <p>© 2025 Gemirose music world</p>
  </div>
</div>

<script>
  const elements = {
    carouselInner: document.querySelector('.carousel-inner'),
    albumCarousel: document.querySelector('.album-carousel'),
    albumDetails: document.querySelector('.album-details'),
    trackList: document.getElementById('trackList'),
    albumImage: document.getElementById('albumImage'),
    albumTitle: document.getElementById('albumTitle'),
    carouselBtns: document.querySelector('.carousel-btns'),
    backBtnContainer: document.querySelector('.back-btn'),
    currentTrackDisplay: document.getElementById('currentTrack'),
    audioPlayer: document.getElementById('audioPlayer'),
    audioSource: document.getElementById('audioSource'),
    prevBtn: document.getElementById('prevBtn'),
    nextBtn: document.getElementById('nextBtn'),
    backBtn: document.getElementById('backBtn'),
    randomBtn: document.getElementById('randomBtn'),

    // 新增自定义播放器控件元素
    playPauseBtn: document.getElementById('playPauseBtn'),
    playIconSpan: document.querySelector('#playPauseBtn .icon-play'), // 选择播放图标的span
    pauseIconSpan: document.querySelector('#playPauseBtn .icon-pause'), // 选择暂停图标的span

    progressBar: document.getElementById('progressBar'),
    currentTimeDisplay: document.getElementById('currentTime'),
    totalTimeDisplay: document.getElementById('totalTime'),

    volumeBtn: document.getElementById('volumeBtn'),
    // 移除音量图标相关的选择器，因为现在是文本
    // volumeUpIconSpan: document.querySelector('#volumeBtn .icon-volume-up'),
    // volumeMuteIconSpan: document.querySelector('#volumeBtn .icon-volume-mute'),

    volumeSlider: document.getElementById('volumeSlider')
  };

  const albumTracks = {
    'like JENNIE': [
      { name: 'like JENNIE (Explicit)', src: 'like JENNIE (Explicit).mp3', duration: '2:03' },
      { name: 'like JENNIE (Peggy Gou Remix)', src: 'like JENNIE (Peggy Gou Remix).mp3', duration: '3:28' },
      { name: 'like JENNIE (Peggy Gou Remix - EXTENDED MIX | Explicit)', src: 'like JENNIE (Peggy Gou Remix - EXTENDED MIX | Explicit).mp3', duration: '5:07' }
    ],
    'Pink Venom': [{ name: 'Pink Venom', src: 'Pink Venom.mp3', duration: '3:06' }],
    'BORN PINK': [
      { name: 'Pink Venom', src: 'Pink Venom.mp3', duration: '3:06' },
      { name: 'Shut Down', src: 'Shut Down.mp3', duration: '2:55' },
      { name: 'Typa Girl (Explicit ver.)', src: 'Typa Girl (Explicit ver.).mp3', duration: '2:59' },
      { name: 'Yeah Yeah Yeah', src: 'Yeah Yeah Yeah.mp3', duration: '2:58' },
      { name: 'Hard to Love (Explicit ver.)', src: 'Hard to Love (Explicit ver.).mp3', duration: '2:42' },
      { name: 'The Happiest Girl', src: 'The Happiest Girl.mp3', duration: '3:42' },
      { name: 'Tally (Explicit ver.)', src: 'Tally (Explicit ver.).mp3', duration: '3:04' },
      { name: 'Ready For Love', src: 'Ready For Love.mp3', duration: '3:04' },
    ],
    'THE ALBUM': [
      { name: 'How You Like That', src: 'How You Like That.mp3', duration: '3:00' },
      { name: 'Ice Cream (with Selena Gomez)', src: 'Ice Cream (with Selena Gomez).mp3', duration: '2:55' },
      { name: 'Pretty Savage', src: 'Pretty Savage.mp3', duration: '3:19' },
      { name: 'Bet You Wanna (Feat. Cardi B)', src: 'Bet You Wanna (Feat. Cardi B).mp3', duration: '2:39' },
      { name: 'Lovesick Girls', src: 'Lovesick Girls.mp3', duration: '3:12' },
      { name: 'Crazy Over You', src: 'Crazy Over You.mp3', duration: '2:41' },
      { name: 'Love To Hate Me', src: 'Love To Hate Me.mp3', duration: '2:49' },
      { name: 'You Never Know', src: 'You Never Know.mp3', duration: '3:49' },
    ],
    'The Girls': [{ name: 'The Girls', src: 'THE GIRLS (BLACKPINK THE GAME OST).mp3', duration: '2:43' }],
    'AMORTAGE': [
      { name: 'Earthquake', src: 'earthquake.mp3', duration: '3:00' },
      { name: 'YOUR LOVE', src: 'YOUR LOVE.mp3', duration: '2:53' },
      { name: 'TEARS', src: 'TEARS.mp3', duration: '3:02' },
      { name: 'HUGS & KISSES', src: 'HUGS & KISSES.mp3', duration: '3:09' }
    ],
    'RUBY': [
      { name: 'Intro: JANE with FKJ', src: 'Intro: JANE with FKJ.mp3', duration: '2:53' },
      { name: 'like JENNIE (Explicit)', src: 'like JENNIE (Explicit).mp3', duration: '2:03' },
      { name: 'start a war (Explicit)', src: 'start a war (Explicit).mp3', duration: '2:45' },
      { name: 'Handlebars (feat. Dua Lipa) (Explicit)', src: 'Handlebars (feat. Dua Lipa) (Explicit).mp3', duration: '3:04' },
      { name: 'with the IE (way up) (Explicit)', src: 'with the IE (way up) (Explicit).mp3', duration: '2:43' },
      { name: 'ExtraL (feat. Doechii) (Explicit)', src: 'ExtraL (feat. Doechii) (Explicit).mp3', duration: '2:47'},
      { name: 'Mantra (Explicit)', src: 'Mantra (Explicit).mp3', duration: '2:16' },
      { name: 'Love Hangover (feat. Dominic Fike) (Explicit)', src: 'Love Hangover (feat. Dominic Fike) (Explicit).mp3', duration: '3:00' },
      { name: 'ZEN (Explicit)', src: 'ZEN (Explicit).mp3', duration: '3:21' },
      { name: 'Damn Right (feat. Childish Gambino and Kali Uchis) (Explicit)', src: 'Damn Right (feat. Childish Gambino and Kali Uchis) (Explicit).mp3', duration: '3:50' },
      { name: 'F.T.S (Explicit)', src: 'F.T.S (Explicit).mp3', duration: '2:32' },
      { name: 'Filter (Explicit)', src: 'Filter (Explicit).mp3', duration: '2:31' },
      { name: 'Seoul City', src: 'Seoul City.mp3', duration: '2:44' },
      { name: 'Starlight (Explicit)', src: 'Starlight (Explicit).mp3', duration: '2:48' },
      { name: 'twin', src: 'twin.mp3', duration: '3:28' }
    ],
    'ROSIE': [
      { name: 'number one girl', src: 'number one girl.mp3', duration: '3:36' },
      { name: '3am', src: '3am.mp3', duration: '2:34' },
      { name: 'two years', src: 'two years.mp3', duration: '2:47' },
      { name: 'toxic till the end', src: 'toxic till the end.mp3', duration: '2:36' },
      { name: 'drinks or coffee', src: 'drinks or coffee.mp3', duration: '2:13' },
      { name: 'APT.', src: 'APT..mp3', duration: '2:49'},
      { name: 'gameboy', src: 'gameboy.mp3', duration: '2:46' },
      { name: 'stay a little longer', src: 'stay a little longer.mp3', duration: '4:06' },
      { name: 'not the same', src: 'not the same.mp3', duration: '3:04' },
      { name: 'call it the end', src: 'call it the end.mp3', duration: '2:21' },
      { name: 'too bad for us', src: 'too bad for us.mp3', duration: '3:56' },
      { name: 'dance all night', src: 'dance all night.mp3', duration: '3:34' },
    ],
    'Number One Girl': [{ name: 'Number One Girl', src: 'number one girl.mp3', duration: '3:36' }],
    'Rockstar': [{ name: 'Rockstar', src: 'Rockstar.mp3', duration: '3:05' }],
    'ALTER EGO': [
      { name: 'Born Again ft. Doja Cat & RAYE', src: 'Born Again ft. Doja Cat & RAYE.mp3', duration: '3:51' },
      { name: 'Rockstar', src: 'Rockstar.mp3', duration: '2:18' },
      { name: 'Elastigirl', src: 'Elastigirl.mp3', duration: '2:57' },
      { name: 'Thunder', src: 'Thunder.mp3', duration: '2:48' },
      { name: 'New Woman ft. ROSALÍA', src: 'New Woman ft. ROSALÍA.mp3', duration: '2:59' },
      { name: 'FXCK UP THE WORLD ft. Future', src: 'FXCK UP THE WORLD (vixi solo version|Explicit).mp3', duration: '3:04'},
      { name: 'Rapunzel ft. Megan Thee Stallion (Explicit)', src: 'Rapunzel ft. Megan Thee Stallion (Explicit).mp3', duration: '2:45' },
      { name: 'Moonlit Floor (Kiss Me)', src: 'Moonlit Floor (Kiss Me).mp3', duration: '2:35' },
      { name: 'When I\'m With You ft. Tyla', src: 'When I\'m With You ft. Tyla.mp3', duration: '2:52' },
      { name: 'BADGRRRL', src: 'BADGRRRL.mp3', duration: '2:12' },
      { name: 'Lifestyle (Explicit)', src: 'Lifestyle (Explicit).mp3', duration: '2:41' },
      { name: 'Chill', src: 'Chill.mp3', duration: '2:39' },
      { name: 'Dream', src: 'Dream.mp3', duration: '3:43' },
      { name: 'FXCK UP THE WORLD (vixi solo version|Explicit)', src: 'FXCK UP THE WORLD (vixi solo version|Explicit).mp3', duration: '2:55' },
      { name: 'Rapunzel (kiki solo version|Explicit)', src: 'Rapunzel (kiki solo version|Explicit).mp3', duration: '2:19' }
    ]
  };

  let currentIndex = 0;
  let touchStartX = 0;
  let touchEndX = 0;
  const totalAlbums = document.querySelectorAll('.carousel-item').length;
  let currentPlayingTrackName = '未选择歌曲'; // 初始化为默认文本
  let currentAlbumName = ''; // 存储当前专辑名称
  let currentTrackIndexInAlbum = -1; // 存储当前歌曲在专辑列表中的索引
  let lastVolume = 1; // 用于静音前的音量

  // 辅助函数：格式化时间
  function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = Math.floor(seconds % 60);
    return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
  }

  // 辅助函数：更新当前播放歌曲的显示
  function updateCurrentTrackDisplay(trackName) {
    elements.currentTrackDisplay.textContent = trackName;
    currentPlayingTrackName = trackName;
  }

  // 播放特定歌曲的函数
  function playTrack(track, album, trackIndex) {
    elements.audioSource.src = track.src;
    elements.audioPlayer.load();
    elements.audioPlayer.play().catch(error => {
      console.error("播放音频时出错:", error);
      updateCurrentTrackDisplay('播放歌曲失败: ' + track.name);
      // 播放失败时，将播放按钮设置为暂停状态
      setPlayPauseIcon(false);
    });
    updateCurrentTrackDisplay(track.name);
    currentAlbumName = album;
    currentTrackIndexInAlbum = trackIndex;

    // 更新播放按钮图标
    setPlayPauseIcon(true);

    // 高亮显示列表中正在播放的歌曲
    const trackItems = elements.trackList.querySelectorAll('.track-item');
    trackItems.forEach(item => item.classList.remove('playing'));
    // 找到与正在播放的歌曲对应的歌曲项，并添加 'playing' 类
    // 使用 trackIndex 更可靠地找到歌曲项
    if (trackIndex !== -1 && trackItems[trackIndex]) {
      trackItems[trackIndex].classList.add('playing');
    }
  }

  // 辅助函数：更新播放/暂停图标的显示
  function setPlayPauseIcon(isPlaying) {
    if (isPlaying) {
      elements.playIconSpan.classList.remove('active-icon');
      elements.playIconSpan.classList.add('inactive-icon');
      elements.pauseIconSpan.classList.remove('inactive-icon');
      elements.pauseIconSpan.classList.add('active-icon');
    } else {
      elements.playIconSpan.classList.remove('inactive-icon');
      elements.playIconSpan.classList.add('active-icon');
      elements.pauseIconSpan.classList.remove('active-icon');
      elements.pauseIconSpan.classList.add('inactive-icon');
    }
  }

  // 辅助函数：更新音量按钮的文本
  function updateVolumeButtonText() {
    if (elements.audioPlayer.muted || elements.audioPlayer.volume === 0) {
      elements.volumeBtn.textContent = '声音';
    } else {
      elements.volumeBtn.textContent = '静音';
    }
  }

  // 事件委托处理专辑点击和键盘事件
  elements.carouselInner.addEventListener('click', (e) => {
    const item = e.target.closest('.carousel-item');
    if (item) {
      const albumName = item.getAttribute('data-album');
      const imgSrc = item.querySelector('img').src;
      showAlbumDetails(albumName, imgSrc);
    }
  });

  elements.carouselInner.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      const item = e.target.closest('.carousel-item');
      if (item) {
        const albumName = item.getAttribute('data-album');
        const imgSrc = item.querySelector('img').src;
        showAlbumDetails(albumName, imgSrc);
      }
    }
  });

  // 轮播按钮事件
  elements.prevBtn.addEventListener('click', () => {
    currentIndex = (currentIndex === 0) ? totalAlbums - 1 : currentIndex - 1;
    updateCarousel();
  });

  elements.nextBtn.addEventListener('click', () => {
    currentIndex = (currentIndex === totalAlbums - 1) ? 0 : currentIndex + 1;
    updateCarousel();
  });

  // 随机播放
  elements.randomBtn.addEventListener('click', () => {
    const albums = Object.keys(albumTracks);
    const randomAlbumName = albums[Math.floor(Math.random() * albums.length)];
    const tracks = albumTracks[randomAlbumName];
    const randomTrackIndex = Math.floor(Math.random() * tracks.length);
    const randomTrack = tracks[randomTrackIndex];

    playTrack(randomTrack, randomAlbumName, randomTrackIndex);

    // 显示随机选择歌曲所属专辑的详情
    const albumItem = document.querySelector(`[data-album="${randomAlbumName}"]`);
    if (albumItem) {
      const imgSrc = albumItem.querySelector('img').src;
      showAlbumDetails(randomAlbumName, imgSrc);
    } else {
      // 理论上不会发生，因为 randomAlbumName 来自 existing keys
      showAlbumDetails(randomAlbumName, 'fallback.jpg');
    }
  });

  // 返回按钮
  elements.backBtn.addEventListener('click', () => {
    elements.albumDetails.classList.add('hidden');
    elements.albumCarousel.classList.remove('hidden');
    elements.carouselBtns.classList.remove('hidden');
    elements.backBtnContainer.classList.add('hidden');
    updateCurrentTrackDisplay(currentPlayingTrackName); // 恢复上次播放的歌曲名称
  });

  // 自定义播放器控制事件
  elements.playPauseBtn.addEventListener('click', () => {
    if (elements.audioPlayer.paused) {
      elements.audioPlayer.play().catch(error => {
        console.error("尝试播放时出错:", error);
        updateCurrentTrackDisplay('播放失败');
        setPlayPauseIcon(false); // 播放失败则设置为暂停状态
      });
      setPlayPauseIcon(true);
    } else {
      elements.audioPlayer.pause();
      setPlayPauseIcon(false);
    }
  });

  elements.progressBar.addEventListener('input', () => {
    // 当用户拖动进度条时，暂停更新进度条位置，防止跳动
    // elements.audioPlayer.pause(); // 可以选择不暂停，但要确保 timeupdate 不会覆盖拖动
    setPlayPauseIcon(false); // 拖动时显示暂停图标
  });

  elements.progressBar.addEventListener('change', () => {
    const seekTime = elements.progressBar.value;
    elements.audioPlayer.currentTime = seekTime;
    elements.audioPlayer.play().catch(error => {
      console.error("拖动后播放时出错:", error);
      updateCurrentTrackDisplay('播放失败');
      setPlayPauseIcon(false); // 播放失败则设置为暂停状态
    });
    setPlayPauseIcon(true);
  });

  elements.volumeBtn.addEventListener('click', () => {
    if (elements.audioPlayer.muted) {
      elements.audioPlayer.muted = false;
      elements.volumeSlider.value = lastVolume; // 恢复到静音前的音量
      elements.audioPlayer.volume = lastVolume;
    } else {
      lastVolume = elements.audioPlayer.volume; // 保存当前音量
      elements.audioPlayer.muted = true;
      elements.volumeSlider.value = 0;
    }
    updateVolumeButtonText(); // 更新音量按钮文本
  });

  elements.volumeSlider.addEventListener('input', () => {
    elements.audioPlayer.volume = elements.volumeSlider.value;
    if (elements.audioPlayer.volume === 0) {
      elements.audioPlayer.muted = true;
    } else {
      elements.audioPlayer.muted = false;
    }
    updateVolumeButtonText(); // 更新音量按钮文本
  });

  // 音频事件监听器
  elements.audioPlayer.addEventListener('loadedmetadata', () => {
    elements.progressBar.max = elements.audioPlayer.duration;
    elements.totalTimeDisplay.textContent = formatTime(elements.audioPlayer.duration);
    elements.currentTimeDisplay.textContent = formatTime(0); // 歌曲加载后重置当前时间显示
    // 确保播放按钮状态正确
    setPlayPauseIcon(!elements.audioPlayer.paused);
  });

  elements.audioPlayer.addEventListener('timeupdate', () => {
    if (!elements.audioPlayer.seeking) { // 避免在拖动进度条时更新
      elements.progressBar.value = elements.audioPlayer.currentTime;
      elements.currentTimeDisplay.textContent = formatTime(elements.audioPlayer.currentTime);
    }
  });

  elements.audioPlayer.addEventListener('ended', () => {
    const currentAlbumTracks = albumTracks[currentAlbumName];
    if (currentAlbumTracks && currentTrackIndexInAlbum !== -1) {
      if (currentTrackIndexInAlbum < currentAlbumTracks.length - 1) {
        // 播放下一首
        const nextTrackIndex = currentTrackIndexInAlbum + 1;
        const nextTrack = currentAlbumTracks[nextTrackIndex];
        playTrack(nextTrack, currentAlbumName, nextTrackIndex);
      } else {
        // 播放列表结束
        elements.audioPlayer.pause();
        setPlayPauseIcon(false);
        updateCurrentTrackDisplay('播放列表已结束');
        // 可选：回到专辑列表视图
        // elements.backBtn.click();
      }
    } else {
      elements.audioPlayer.pause();
      setPlayPauseIcon(false);
      updateCurrentTrackDisplay('播放列表已结束');
    }
  });

  elements.audioPlayer.addEventListener('play', () => {
    setPlayPauseIcon(true);
  });

  elements.audioPlayer.addEventListener('pause', () => {
    setPlayPauseIcon(false);
  });

  elements.audioPlayer.addEventListener('error', () => {
    updateCurrentTrackDisplay('加载歌曲失败，请检查网络或文件路径');
    setPlayPauseIcon(false); // 错误时也设置为暂停状态
  });

  // 触摸滑动
  elements.carouselInner.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
  });

  elements.carouselInner.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    const threshold = 50;
    if (touchStartX - touchEndX > threshold) {
      currentIndex = (currentIndex === totalAlbums - 1) ? 0 : currentIndex + 1;
      updateCarousel();
    }
    if (touchEndX - touchStartX > threshold) {
      currentIndex = (currentIndex === 0) ? totalAlbums - 1 : currentIndex - 1;
      updateCarousel();
    }
  });

  // 更新轮播
  function updateCarousel() {
    const firstItem = elements.carouselInner.querySelector('.carousel-item');
    if (firstItem) {
      const itemWidth = firstItem.offsetWidth;
      const itemStyle = getComputedStyle(firstItem);
      const itemMarginLeft = parseFloat(itemStyle.marginLeft);
      const itemMarginRight = parseFloat(itemStyle.marginRight);
      const totalItemWidth = itemWidth + itemMarginLeft + itemMarginRight;
      
      // 计算轮播容器的可见宽度
      const carouselVisibleWidth = elements.albumCarousel.offsetWidth - parseFloat(getComputedStyle(elements.albumCarousel).paddingLeft) - parseFloat(getComputedStyle(elements.albumCarousel).paddingRight);
      // 计算所有项目的总宽度
      const totalContentWidth = totalAlbums * totalItemWidth;
      
      // 计算基础偏移量
      let offset = -currentIndex * totalItemWidth;

      // 如果所有项目的总宽度小于或等于容器可见宽度，则不进行偏移，或者根据需要居中
      if (totalContentWidth <= carouselVisibleWidth) {
        offset = 0; // 或者计算居中偏移量 (carouselVisibleWidth - totalContentWidth) / 2;
      } else {
        // 计算最大允许的偏移量，以防止末尾出现空白
        // 最大偏移量 = -(所有项目的总宽度 - 轮播容器的可见宽度)
        const maxOffset = -(totalContentWidth - carouselVisibleWidth);
        // 如果计算出的偏移量超出了最大允许偏移量（即向左移动太多），则使用最大偏移量
        if (offset < maxOffset) {
          offset = maxOffset;
        }
        // 同时，确保偏移量不会大于0（即不会向右移动超出初始位置）
        if (offset > 0) {
            offset = 0;
        }
      }
      
      elements.carouselInner.style.transform = `translateX(${offset}px)`;
    }
  }

  // 初始化时调用一次，确保布局正确
  updateCarousel();

  // 监听窗口大小变化，重新计算轮播位置
  window.addEventListener('resize', updateCarousel);

  // 显示专辑详情并填充歌曲列表
  function showAlbumDetails(albumName, imgSrc) {
    elements.albumCarousel.classList.add('hidden');
    elements.carouselBtns.classList.add('hidden');
    elements.albumDetails.classList.remove('hidden');
    elements.backBtnContainer.classList.remove('hidden');

    elements.albumImage.src = imgSrc;
    elements.albumImage.alt = `${albumName} 专辑封面`;
    elements.albumTitle.textContent = albumName;
    elements.trackList.innerHTML = ''; // 清空之前的歌曲列表

    const tracks = albumTracks[albumName] || [];
    if (tracks.length === 0) {
      elements.trackList.innerHTML = '<p>此专辑暂无歌曲。</p>';
      return;
    }

    tracks.forEach((track, index) => {
      const trackItem = document.createElement('div');
      trackItem.classList.add('track-item');
      trackItem.innerHTML = `
        <span class="track-number">${index + 1}</span>
        <span class="track-name">${track.name}</span>
        <span class="track-duration">${track.duration}</span>
      `;
      trackItem.setAttribute('tabindex', '0');
      trackItem.setAttribute('role', 'button');
      trackItem.setAttribute('aria-label', `播放 ${track.name}`);

      trackItem.addEventListener('click', () => {
        // 在 playTrack 中传递 albumName 和 trackIndex
        playTrack(track, albumName, index);
      });
      trackItem.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          trackItem.click();
        }
      });
      elements.trackList.appendChild(trackItem);
    });

    // 确保返回专辑详情时，播放器显示正确的歌曲和状态
    const currentAlbumTracks = albumTracks[currentAlbumName];
    if (currentAlbumTracks && currentTrackIndexInAlbum !== -1 && currentAlbumName === albumName) {
      // 如果当前播放的歌曲属于此专辑，则高亮显示
      const trackItems = elements.trackList.querySelectorAll('.track-item');
      if (trackItems[currentTrackIndexInAlbum]) {
        trackItems[currentTrackIndexInAlbum].classList.add('playing');
      }
    }
  }

  // 初始化音量滑块和按钮状态
  elements.volumeSlider.value = elements.audioPlayer.volume;
  updateVolumeButtonText(); // 初始化音量按钮文本

  // 初始化播放/暂停图标状态（假设初始是暂停状态）
  setPlayPauseIcon(!elements.audioPlayer.paused);

  // 确保初始时显示正确的歌曲名称
  updateCurrentTrackDisplay(currentPlayingTrackName);
</script>

</body>
</html>
